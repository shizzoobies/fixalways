---
import BaseLayout from "../layouts/BaseLayout.astro";
import { floridaCities } from "../data/fl-cities.js";
import { services, defaultServiceKey } from "../data/services.js";

function toSlug(city) {
  return city
    .toLowerCase()
    .trim()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9-]/g, "");
}

const popularCities = [
  "Jacksonville",
  "Miami",
  "Tampa",
  "Orlando",
  "St. Petersburg",
  "Hialeah",
  "Tallahassee",
  "Fort Lauderdale",
  "Cape Coral",
  "Pembroke Pines",
];

const defaultService = services.find((s) => s.key === defaultServiceKey) || services[0];
const defaultServiceFolder = defaultService?.key || "hvac";
---

<BaseLayout
  title="FixAlways | Florida Home Services"
  description="Browse trusted home service companies across Florida. Compare HVAC providers by city with real contact info and reviews."
  badge="Florida • Home Services"
>
  <!-- HERO -->
  <section class="section sectionTight">
    <div class="heroWrap">
      <div class="heroLeft">
        <h1 class="heroTitle">Find trusted home service pros in Florida</h1>
        <p class="heroSubtitle">
          Browse HVAC companies by city with real contact info and reviews.
          More services coming soon.
        </p>

        <div class="heroBadges">
          <span class="badge">Local companies</span>
          <span class="badge">Real reviews</span>
          <span class="badge">Fast browsing</span>
        </div>

        <div class="heroActions">
          <a class="btn btnPrimary" href="#cities">Browse cities</a>
          <a class="btn btnGhost" href={`/fl/tampa/${defaultServiceFolder}`}>View Tampa HVAC</a>
        </div>
      </div>
    </div>
  </section>

  <!-- CITIES -->
  <section class="section" id="cities">
    <div class="sectionHeader">
      <h2 class="sectionTitle">Browse Florida cities</h2>
      <p class="sectionSubtitle">Pick a city to view local HVAC providers.</p>
    </div>

    <div class="card cityPanel">
      <div class="cityTools">
        <div class="cityCount">
          <span id="cityCount">{floridaCities.length}</span> cities
        </div>

        <div class="citySearchRow">
          <input
            id="cityFilter"
            class="input"
            type="text"
            placeholder="Filter cities… (ex: Tampa, Miami, Orl)"
            autocomplete="off"
          />
          <button id="clearCityFilter" class="btn btnGhost" type="button">
            Clear
          </button>
        </div>
      </div>

      <div class="citySectionLabel">Popular</div>
      <div class="cityGrid" id="popularCities">
        {popularCities.map((city) => (
          <a
            class="cityCard"
            href={`/fl/${toSlug(city)}/${defaultServiceFolder}`}
            data-city={city.toLowerCase()}
          >
            <span>{city}</span>
            <span class="cityCardMeta">View listings →</span>
          </a>
        ))}
      </div>

      <details class="cityDetails">
        <summary class="citySummary">
          <span>All cities</span>
          <span class="citySummaryHint">tap to expand</span>
        </summary>

        <div class="cityList" id="cityList">
          {floridaCities.map((city) => (
            <a
              class="cityRow"
              href={`/fl/${toSlug(city)}/${defaultServiceFolder}`}
              data-city={city.toLowerCase()}
            >
              {city}
            </a>
          ))}
        </div>

        <div class="cityEmpty" id="cityEmpty" hidden>
          No matches. Try a different spelling.
        </div>

        <p class="cityHint">
          Tip: use the service selector in the header to switch services.
        </p>
      </details>
    </div>

    <script type="module" src="/js/city-list.js"></script>
  </section>
</BaseLayout>
